include /contentheader/contentheader.pug
include /icon/icon.pug
include /permalink/permalink.pug

mixin variant(variant, includeDetails)
  - const variantId = h.dasherize(variant.id)
  - const hasPreview = variant.rendered
  - const hasCode = variant.raw || variant.context || variant.rendered
  - const actionlistId = `${h.dasherize(variant.id)}-actionlist`
  article.variant(id=h.dasherize(variant.id))&attributes(attributes)
    +contentheader().sob-m
      if variant.label
        span.contentheader__label= variant.label

      h2.contentheader__title= variant.title

      if hasPreview && hasCode
        .contentheader__options
          +contentheaderOption(`${variantId}-preview`, h.t('variant.preview'), true)
          +contentheaderOption(`${variantId}-code`, h.t('variant.code'), false)

      .contentheader__actions
        button.contentheader__actiontoggle(type="button" data-actionlist-target=actionlistId)
          +icon('tools')
        ul.contentheader__actionlist(id=actionlistId)
          li.contentheader__action
            +permalink(`#${variantId}`, h.t('variant.copy_permalink')).contentheader__actionlink
          li.contentheader__action
            a.contentheader__actionlink(href=h.variantPreviewPath(variant.id) target=variantId)
              +icon('open-in-window')
              = h.t('variant.open_in_window')
          li.contentheader__action
            form(action="https://codepen.io/pen/define" method="POST" target="_blank")
              input(type="hidden" name="data" data-value=JSON.stringify({ title: variant.title, html: variant.rendered, language: variant.extension, raw: variant.raw }))
              a.contentheader__actionlink.contentheader__actionlink--codepen(href="#" data-variant-target=variantId)
                +icon('globe')
                = h.t('variant.edit_on_codepen')

    if variant.content
      .content
        != variant.content

    if hasPreview || hasCode
      .contentsections.sot-xl
        if hasPreview
          - const classes = 'contentsection--active'
          +__variantpreview(variant).contentsection(id=`${variantId}-preview` class=classes)

        if hasCode
          - const classes = !hasPreview ? 'contentsection--active' : null
          +__variantcode(variant, !variant.rendered).contentsection(id=`${variantId}-code` class=classes)


mixin __variantcode(variant)
  .variantcode&attributes(attributes)
    .variantcode__segments
      if variant.raw
        .variantcode__segment.variantcode__segment--expanded
          header.variantcode__header(role="button")
            h4.variantcode__title= h.t('variant.raw')
            +icon('caret-down-double').variantcode__expandicon
          .variantcode__content
            pre.variantcode__raw.hljs(lang=variant.extension)
              != h.decorateRaw(variant.raw, variant.extension)

      if variant.context
        .variantcode__segment.variantcode__segment--expanded
          header.variantcode__header(role="button")
            h4.variantcode__title= h.t('variant.context')
            +icon('caret-down-double').variantcode__expandicon
          .variantcode__content
            pre.variantcode__context.hljs(lang="json")
              != h.decorateContext(variant.context)

      if variant.rendered
        .variantcode__segment(id=blockId)
          header.variantcode__header(role="button")
            h4.variantcode__title= h.t('variant.rendered')
            +icon('caret-down-double').variantcode__expandicon
          .variantcode__content
            pre.variantcode__rendered.hljs(lang="html")
              != h.decorateRendered(variant.rendered)

mixin __variantpreview(variant)
  - const variantId = h.dasherize(variant.id)
  - const breakpointsId = `${variantId}-breakpoints`
  - const containerId = `${variantId}-container`
  .variantpreview&attributes(attributes)
    .variantpreview__container(id=containerId data-variant-id=variantId)
      .variantpreview__size
        if config.breakpoints
          button.variantpreview__sizer(type="button" data-breakpoints-target=breakpointsId)
      script.
        var width = window.sessionStorage.getItem('variant:width:#{variantId}');
        if (width) { document.getElementById('#{containerId}').style.width = width + 'px' }
      iframe.variantpreview__iframe(src=h.variantPreviewPath(variant.id) frameborder="0" scrolling="no")
    if config.breakpoints
      .variantpreview__breakpoints(id=breakpointsId)
        .variantpreview__breakpoints-inner
          each width, breakpoint in config.breakpoints
            button.variantpreview__breakpoint(type="button" data-width=width data-breakpoint=breakpoint data-breakpoints-target=breakpointsId data-container-target=containerId)
              = `${breakpoint}: ${width}px`
          button.variantpreview__breakpoint(type="button" data-breakpoints-target=breakpointsId data-container-target=containerId)
            = h.t('breakpoints.reset')
