include /icon/icon.pug
include /permalink/permalink.pug
include /variantcode/variantcode.pug
include /variantpreview/variantpreview.pug

mixin variant(variant, includeDetails)
  - const variantId = h.dasherize(variant.id)
  - const hasPreview = variant.rendered
  - const hasCode = variant.raw || variant.context || variant.rendered
  - const actionlistId = `${h.dasherize(variant.id)}-actionlist`
  article.variant(id=h.dasherize(variant.id))&attributes(attributes)
    header.variantheader&attributes(attributes)
      .variantheader__inner.wrap
        div.variantheader__meta
          if includeDetails
            span.variantheader__naming= h.t('variant.naming')
          if variant.status
            span.variantheader__status= variant.status
          if variant.label
            span.variantheader__label= variant.label

        if includeDetails
          h2.variantheader__title= variant.title

        if hasPreview && hasCode
          nav.variantheader__links
            if hasPreview
              +variantheaderLink(`${variantId}-preview`, h.t('variant.preview'), true)
            if hasCode
              +variantheaderLink(`${variantId}-code`, h.t('variant.code'), !hasPreview)

        .variantheader__actions
          button.variantheader__actiontoggle(type="button" data-actionlist-target=actionlistId)
            +icon('tools')

          ul.variantheader__actionlist(id=actionlistId)
            li.variantheader__action
              +permalink(`#${variantId}`, h.t('variant.copy_permalink')).variantheader__actionlink
            li.variantheader__action
              a.variantheader__actionlink(href=h.variantPreviewPath(variant.id) target=variantId)
                +icon('open-in-window')
                = h.t('variant.open_in_window')
            li.variantheader__action
              form(action="https://codepen.io/pen/define" method="POST" target="_blank")
                input(type="hidden" name="data" data-value=JSON.stringify({ title: variant.title, html: variant.rendered, language: variant.extension, raw: variant.raw }))
                a.variantheader__actionlink.variantheader__actionlink--codepen(href="#" data-variant-target=variantId)
                  +icon('globe')
                  = h.t('variant.edit_on_codepen')

    if variant.content
      article.content.wrap
        != variant.content

    if hasPreview || hasCode
      .variant__sections
        if hasPreview
          - const classes = 'variant__section--active'
          +variantpreview(variant).variant__section(id=`${variantId}-preview` class=classes)

        if hasCode
          - const classes = !hasPreview ? 'variant__section--active' : null
          +variantcode(variant, !variant.rendered).variant__section(id=`${variantId}-code` class=classes)


mixin variantheaderLink(id, title, isActive)
  - const classes = isActive ? 'variantheader__link--active' : null
  a.variantheader__link(href=`#${id}` class=classes)= title
